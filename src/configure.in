
#--------------------------------------------------------------------
#
# MODULE      : configure.in
# DESCRIPTION : TeXmacs configuration file for autoconf
# COPYRIGHT   : (C) 2000  Joris van der Hoeven
#
# This software falls under the GNU general public license version 3 or later.
# It comes WITHOUT ANY WARRANTY WHATSOEVER. For details, see the file LICENSE
# in the root directory or <http://www.gnu.org/licenses/gpl-3.0.html>.
#
#--------------------------------------------------------------------

AC_INIT
AC_CONFIG_HEADERS([src/System/config.h:src/System/config.in])
AC_CANONICAL_HOST

#--------------------------------------------------------------------
# Export version and package name 
#--------------------------------------------------------------------

TM_SUBVERSION

PACKAGE="TeXmacs"
DEBIAN_NAME="texmacs"
DEVEL_VERSION="1.99.5"
DEVEL_RELEASE="1"         # I think we should use SVNREV here
STABLE_VERSION="1.99.5"
STABLE_RELEASE="1"

DEVEL_VERSION_MAJOR="1"   #testing
DEVEL_VERSION_MINOR="8"
AC_SUBST(DEVEL_VERSION_MINOR)
AC_SUBST(DEVEL_VERSION_MAJOR)

AC_SUBST(PACKAGE)
AC_SUBST(DEVEL_VERSION)
AC_SUBST(DEVEL_RELEASE)
AC_SUBST(STABLE_VERSION)
AC_SUBST(STABLE_RELEASE)

#--------------------------------------------------------------------
# Checks for C++ compiler
#--------------------------------------------------------------------

AC_PROG_CC
AC_PROG_CXX
AC_PROG_OBJC([clang gcc])
AC_PROG_OBJCXX([clang++ g++])
AC_LANG_CPLUSPLUS
AH_TEMPLATE([OLD_GNU_COMPILER],[Use g++ strictly prior to g++ 3.0])
AC_MSG_CHECKING(whether GNU C++ compiler is default)
case "$GXX" in
  yes )
    GCC_VERSION=`$CC -dumpversion`
    GXX_VERSION=`$CXX -dumpversion`
    AC_MSG_RESULT(yes)
    AC_MSG_CHECKING(version of gcc)
    AC_MSG_RESULT($GCC_VERSION)
    AC_MSG_CHECKING(version of g++)
    AC_MSG_RESULT($GXX_VERSION)
    case "$GXX_VERSION" in
      0* | 1* | 2*)
        echo "old style GNU compiler"
        AC_DEFINE([OLD_GNU_COMPILER],[])
      ;;
    esac
  ;;
  *)
    GCC_VERSION="none"
    GXX_VERSION="none"
    AC_MSG_RESULT(no)
    AC_MSG_WARN(cannot find GNU C++ compiler)
  ;;
esac
AC_CPLUSPLUS_STACK

#--------------------------------------------------------------------
# Checks for standard functionality
#--------------------------------------------------------------------

LC_X_HEADERS
AC_CHECK_TYPES(FILE)
AC_CHECK_TYPES(intptr_t)
AC_CHECK_TYPES(time_t)
AC_PATH_X
AC_PATH_XTRA
AC_CHECK_HEADERS(pty.h util.h)
AC_CHECK_FUNCS(gettimeofday)

#--------------------------------------------------------------------
# Checks for Guile
#--------------------------------------------------------------------
LC_GUILE

#--------------------------------------------------------------------
# Checks for dl library
#--------------------------------------------------------------------
LC_DLOPEN

#--------------------------------------------------------------------
# Checks for iconv library
#--------------------------------------------------------------------
LC_ICONV

#--------------------------------------------------------------------
# Checks for freetype library
#--------------------------------------------------------------------
LC_FREETYPE

#--------------------------------------------------------------------
# Checks for Cairo library
#--------------------------------------------------------------------
LC_CAIRO

#--------------------------------------------------------------------
# Checks for Imlib2 library
#--------------------------------------------------------------------
LC_IMLIB2

#--------------------------------------------------------------------
# Checks for Axel library
#--------------------------------------------------------------------
LC_AXEL
#--------------------------------------------------------------------
# Checks for ghostscript library
#--------------------------------------------------------------------
LC_GS

#--------------------------------------------------------------------
# Checks for sqlite3 library
#--------------------------------------------------------------------
LC_SQL

#--------------------------------------------------------------------
# Checks for (Win)Sparkle framework
#--------------------------------------------------------------------
LC_SPARKLE

#--------------------------------------------------------------------
# Handle different systems case by case
#--------------------------------------------------------------------
TM_PLATFORM

#--------------------------------------------------------------------
# Memory allocation options
#--------------------------------------------------------------------

TM_FASTALLOC

#--------------------------------------------------------------------
# MacOS X extensions (spellchecker, image loading)
#--------------------------------------------------------------------

TM_MACOS

#--------------------------------------------------------------------
# Windows console
#--------------------------------------------------------------------

TM_WINDOWS

#--------------------------------------------------------------------
# Gui selection
#--------------------------------------------------------------------

TM_GUI

#--------------------------------------------------------------------
# Native PDF renderer based on Hummus
#--------------------------------------------------------------------

LC_HUMMUS

#--------------------------------------------------------------------
# Debugging options
#--------------------------------------------------------------------

TM_DEBUG

#--------------------------------------------------------------------
# Optimization options
#--------------------------------------------------------------------

TM_OPTIMIZE

#--------------------------------------------------------------------
# Default paths for installation
#--------------------------------------------------------------------

TM_INSTALL

#--------------------------------------------------------------------
# Done
#--------------------------------------------------------------------
AC_OUTPUT(Makefile:Makefile.in src/makefile:src/makefile.in src/System/tm_configure.hpp:src/System/tm_configure.in misc/admin/admin.makefile:misc/admin/admin.makefile.in misc/doxygen/Doxyfile:misc/doxygen/Doxyfile.in misc/man/texmacs.1:misc/man/texmacs.1.in packages/redhat/TeXmacs.spec:packages/redhat/TeXmacs.spec.in misc/scripts/fig2ps:misc/scripts/fig2ps.in misc/scripts/texmacs:misc/scripts/texmacs.in TeXmacs/examples/plugins/dynlink/Makefile:TeXmacs/examples/plugins/dynlink/Makefile.in packages/macos/Base.xcconfig:packages/macos/Base.xcconfig.in packages/macos/Info-Xcode.plist:packages/macos/Info-Xcode.plist.in packages/macos/Info.plist:packages/macos/Info.plist.in packages/fedora/TeXmacs.spec:packages/fedora/TeXmacs.spec.in packages/mandriva/TeXmacs.spec:packages/mandriva/TeXmacs.spec.in packages/centos/TeXmacs.spec:packages/centos/TeXmacs.spec.in packages/windows/TeXmacs.iss:packages/windows/TeXmacs.iss.in packages/windows/resource.rc:packages/windows/resource.rc.in packages/debian/changelog:packages/debian/changelog.in packages/debian/control:packages/debian/control.in)
